const apiUrl="https://api.wallapop.com/api/v3/users";let cachedProducts=[];const overlay=document.getElementById("loading-overlay"),searchProductsInput=document.getElementById("search-products"),sortProductsSelect=document.getElementById("sort-products"),modal=document.getElementById("product-modal");function extractSlug(e){if(e.startsWith("https://")){const t=e.split("/");return t[t.length-1]}return e}async function triggerSearch(e){if(!e)return void alert("Por favor, introduce un slug válido.");const t=`${window.location.origin}${window.location.pathname}?u=${e}`;window.history.replaceState(null,"",t),toggleLoading(!0);try{const{userId:t,userInfo:o}=await fetchUserData(e);cachedProducts=await fetchUserProducts(t),displayUserInfo(o),displayProducts(cachedProducts),toggleFilters(!1)}catch(e){alert("Error al recuperar datos del usuario: "+e.message)}finally{toggleLoading(!1)}}window.addEventListener("DOMContentLoaded",(()=>{const e=new URLSearchParams(window.location.search).get("u");if(e){const t=extractSlug(e);document.getElementById("user-slug").value=t,triggerSearch(t)}}));const searchButton=document.getElementById("search-user");function toggleLoading(e){overlay.style.display=e?"flex":"none",document.body.style.pointerEvents=e?"none":"auto"}function toggleFilters(e){searchProductsInput.disabled=e,sortProductsSelect.disabled=e}async function fetchUserData(e){const t=await fetch(`https://cors.dcimorra.es/https://es.wallapop.com/user/${e}`),o=await t.text(),n=(new DOMParser).parseFromString(o,"text/html").querySelector("#__NEXT_DATA__");if(!n)throw new Error("No se pudo obtener los datos del usuario.");const r=JSON.parse(n.textContent),a=r.props.pageProps.user,s=r.props.pageProps.userStats||{};return{userId:a.id,userInfo:{avatarImage:a.avatarImage||"",microName:a.microName||"",location:a.location?.city||"",registerDate:a.registerDate||"",userStats:s}}}async function fetchUserProducts(e){let t=[],o=null;do{const n=await fetch(`${apiUrl}/${e}/items${o?`?since=${o}`:""}`),r=await n.clone().json();t=t.concat(r.data.map((e=>({title:e.title,description:e.description,images:e.images.map((e=>e.urls.big)),price:e.price,reserved:e.reserved?.flag||!1,slug:e.slug,shippingEnabled:e.shipping?.item_is_shippable||!1})))),o=r.meta?.next}while(o);return t}function displayUserInfo(e){const t=e.userStats?.counters||{};document.getElementById("user-avatar").src=e.avatarImage||"https://placehold.co/200",document.getElementById("user-name").textContent=e.microName||"Usuario desconocido",document.getElementById("user-location").textContent=`Ubicación: ${e.location||"Desconocida"}`,document.getElementById("user-register-date").textContent=`Fecha de registro: ${formatDate(e.registerDate)}`,document.getElementById("user-total-products").textContent=`Productos publicados: ${t.publish||0}`,document.getElementById("user-buys").textContent=`Compras realizadas: ${t.buys||0}`,document.getElementById("user-sells").textContent=`Ventas realizadas: ${t.sells||0}`,document.getElementById("user-reviews").textContent=`Número de reviews: ${t.reviews||0}`}function displayProducts(e){const t=document.getElementById("products-container");t.innerHTML="",e.forEach((e=>{const o=document.createElement("div");o.classList.add("product"),o.innerHTML=`\n            <img src="${e.images[0]}" alt="${e.title}">\n            <h3>${e.title}</h3>\n            <p>${e.price.amount} ${e.price.currency}</p>\n            <p>Reservado: ${e.reserved?"Sí":"No"}</p>\n            <p>Envío activado: ${e.shippingEnabled?"Sí":"No"}</p>\n        `,o.addEventListener("click",(()=>showProductModal(e))),t.appendChild(o)}))}function formatDate(e){if(!e)return"Desconocida";return new Date(e).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function showProductModal(e){document.getElementById("modal-title").textContent=e.title,document.getElementById("modal-image").src=e.images[0],document.getElementById("modal-description").textContent=e.description,document.getElementById("modal-price").textContent=`Precio: ${e.price.amount} ${e.price.currency}`,document.getElementById("modal-reserved").textContent="Reservado: "+(e.reserved?"Sí":"No"),document.getElementById("modal-link").href=`https://es.wallapop.com/item/${e.slug}`,modal.style.display="flex",document.getElementById("close-modal").addEventListener("click",(()=>{modal.style.display="none"}))}searchButton&&searchButton.addEventListener("click",(()=>{triggerSearch(extractSlug(document.getElementById("user-slug").value.trim()))})),searchProductsInput.addEventListener("input",(e=>{const t=e.target.value.toLowerCase();displayProducts(cachedProducts.filter((e=>e.title.toLowerCase().includes(t))))})),sortProductsSelect.addEventListener("change",(e=>{const t=e.target.value;let o=[...cachedProducts];"name-asc"===t?o.sort(((e,t)=>e.title.localeCompare(t.title))):"name-desc"===t?o.sort(((e,t)=>t.title.localeCompare(e.title))):"price-asc"===t?o.sort(((e,t)=>e.price.amount-t.price.amount)):"price-desc"===t&&o.sort(((e,t)=>t.price.amount-e.price.amount)),displayProducts(o)}));
//# sourceMappingURL=main.min.js.map
