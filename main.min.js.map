{"version":3,"file":"main.min.js","names":["apiUrl","cachedProducts","overlay","document","getElementById","searchProductsInput","sortProductsSelect","modal","extractSlug","input","startsWith","parts","split","length","async","triggerSearch","slug","alert","newUrl","window","location","origin","pathname","history","replaceState","toggleLoading","userId","userInfo","fetchUserData","fetchUserProducts","displayUserInfo","displayProducts","toggleFilters","error","message","addEventListener","slugParam","URLSearchParams","search","get","value","searchButton","isLoading","style","display","body","pointerEvents","isDisabled","disabled","response","fetch","text","nextDataElement","DOMParser","parseFromString","querySelector","Error","nextData","JSON","parse","textContent","user","props","pageProps","userStats","id","avatarImage","microName","city","registerDate","products","next","data","clone","json","concat","map","item","title","description","images","img","urls","big","price","reserved","flag","shippingEnabled","shipping","item_is_shippable","meta","counters","src","formatDate","publish","buys","sells","reviews","productsContainer","innerHTML","forEach","product","productCard","createElement","classList","add","amount","currency","showProductModal","appendChild","timestamp","Date","toLocaleString","day","month","year","hour","minute","second","href","trim","e","query","target","toLowerCase","filter","includes","sortedProducts","sort","a","b","localeCompare"],"sources":["main.js"],"mappings":"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","ignoreList":[],"sourcesContent":["const apiUrl = \"https://api.wallapop.com/api/v3/users\";\nlet cachedProducts = [];\n\n\nconst overlay = document.getElementById(\"loading-overlay\");\nconst searchProductsInput = document.getElementById(\"search-products\");\nconst sortProductsSelect = document.getElementById(\"sort-products\");\nconst modal = document.getElementById(\"product-modal\");\n\n// Función para extraer el username de una URL completa\nfunction extractSlug(input) {\n    if (input.startsWith(\"https://\")) {\n        const parts = input.split(\"/\");\n        return parts[parts.length - 1];\n    }\n    return input;\n}\n\n// Disparar búsqueda al cargar si ?u está en la URL\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const slugParam = urlParams.get(\"u\");\n    if (slugParam) {\n        const slug = extractSlug(slugParam);\n        document.getElementById(\"user-slug\").value = slug;\n        triggerSearch(slug);\n    }\n});\n\n// Función para manejar la búsqueda\nasync function triggerSearch(slug) {\n    if (!slug) {\n        alert(\"Por favor, introduce un slug válido.\");\n        return;\n    }\n\n    // Actualizar la URL con el parámetro ?u\n    const newUrl = `${window.location.origin}${window.location.pathname}?u=${slug}`;\n    window.history.replaceState(null, \"\", newUrl);\n\n    toggleLoading(true);\n\n    try {\n        const { userId, userInfo } = await fetchUserData(slug);\n        cachedProducts = await fetchUserProducts(userId);\n        displayUserInfo(userInfo);\n        displayProducts(cachedProducts);\n        toggleFilters(false);\n    } catch (error) {\n        alert(\"Error al recuperar datos del usuario: \" + error.message);\n    } finally {\n        toggleLoading(false);\n    }\n}\n\n// Evento de clic en el botón de búsqueda\nconst searchButton = document.getElementById(\"search-user\");\nif (searchButton) {\n    searchButton.addEventListener(\"click\", () => {\n        const slugInput = document.getElementById(\"user-slug\").value.trim();\n        const slug = extractSlug(slugInput);\n        triggerSearch(slug);\n    });\n}\n\nsearchProductsInput.addEventListener(\"input\", (e) => {\n    const query = e.target.value.toLowerCase();\n    const filteredProducts = cachedProducts.filter(product =>\n        product.title.toLowerCase().includes(query)\n    );\n    displayProducts(filteredProducts);\n});\n\nsortProductsSelect.addEventListener(\"change\", (e) => {\n    const value = e.target.value;\n    let sortedProducts = [...cachedProducts];\n\n    if (value === \"name-asc\") {\n        sortedProducts.sort((a, b) => a.title.localeCompare(b.title));\n    } else if (value === \"name-desc\") {\n        sortedProducts.sort((a, b) => b.title.localeCompare(a.title));\n    } else if (value === \"price-asc\") {\n        sortedProducts.sort((a, b) => a.price.amount - b.price.amount);\n    } else if (value === \"price-desc\") {\n        sortedProducts.sort((a, b) => b.price.amount - a.price.amount);\n    }\n\n    displayProducts(sortedProducts);\n});\n\nfunction toggleLoading(isLoading) {\n    overlay.style.display = isLoading ? \"flex\" : \"none\";\n    document.body.style.pointerEvents = isLoading ? \"none\" : \"auto\";\n}\n\nfunction toggleFilters(isDisabled) {\n    searchProductsInput.disabled = isDisabled;\n    sortProductsSelect.disabled = isDisabled;\n}\n\nasync function fetchUserData(slug) {\n    const response = await fetch(`https://cors.dcimorra.es/https://es.wallapop.com/user/${slug}`);\n    const text = await response.text();\n    const parser = new DOMParser();\n    const htmlDoc = parser.parseFromString(text, \"text/html\");\n    const nextDataElement = htmlDoc.querySelector('#__NEXT_DATA__');\n    if (!nextDataElement) throw new Error(\"No se pudo obtener los datos del usuario.\");\n\n    const nextData = JSON.parse(nextDataElement.textContent);\n    const user = nextData.props.pageProps.user;\n    const userStats = nextData.props.pageProps.userStats || {};\n\n    return {\n        userId: user.id,\n        userInfo: {\n            avatarImage: user.avatarImage || \"\",\n            microName: user.microName || \"\",\n            location: user.location?.city || \"\",\n            registerDate: user.registerDate || \"\",\n            userStats: userStats\n        }\n    };\n}\n\nasync function fetchUserProducts(userId) {\n    let products = [];\n    let next = null;\n\n    do {\n        const response = await fetch(`${apiUrl}/${userId}/items${next ? `?since=${next}` : \"\"}`);\n        const data = await response.clone().json();\n        products = products.concat(data.data.map(item => ({\n            title: item.title,\n            description: item.description,\n            images: item.images.map(img => img.urls.big),\n            price: item.price,\n            reserved: item.reserved?.flag || false,\n            slug: item.slug,\n            shippingEnabled: item.shipping?.item_is_shippable || false\n        })));\n        next = data.meta?.next;\n    } while (next);\n\n    return products;\n}\n\nfunction displayUserInfo(userInfo) {\n    const userStats = userInfo.userStats?.counters || {};\n\n    document.getElementById(\"user-avatar\").src = userInfo.avatarImage || \"https://placehold.co/200\";\n    document.getElementById(\"user-name\").textContent = userInfo.microName || \"Usuario desconocido\";\n    document.getElementById(\"user-location\").textContent = `Ubicación: ${userInfo.location || \"Desconocida\"}`;\n    document.getElementById(\"user-register-date\").textContent = `Fecha de registro: ${formatDate(userInfo.registerDate)}`;\n    document.getElementById(\"user-total-products\").textContent = `Productos publicados: ${userStats.publish || 0}`;\n    document.getElementById(\"user-buys\").textContent = `Compras realizadas: ${userStats.buys || 0}`;\n    document.getElementById(\"user-sells\").textContent = `Ventas realizadas: ${userStats.sells || 0}`;\n    document.getElementById(\"user-reviews\").textContent = `Número de reviews: ${userStats.reviews || 0}`;\n}\n\nfunction displayProducts(products) {\n    const productsContainer = document.getElementById(\"products-container\");\n    productsContainer.innerHTML = \"\";\n    products.forEach(product => {\n        const productCard = document.createElement(\"div\");\n        productCard.classList.add(\"product\");\n        productCard.innerHTML = `\n            <img src=\"${product.images[0]}\" alt=\"${product.title}\">\n            <h3>${product.title}</h3>\n            <p>${product.price.amount} ${product.price.currency}</p>\n            <p>Reservado: ${product.reserved ? \"Sí\" : \"No\"}</p>\n            <p>Envío activado: ${product.shippingEnabled ? \"Sí\" : \"No\"}</p>\n        `;\n        productCard.addEventListener(\"click\", () => showProductModal(product));\n        productsContainer.appendChild(productCard);\n    });\n}\n\nfunction formatDate(timestamp) {\n    if (!timestamp) return \"Desconocida\";\n    const date = new Date(timestamp);\n    return date.toLocaleString(\"es-ES\", {\n        day: \"2-digit\",\n        month: \"2-digit\",\n        year: \"numeric\",\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n        second: \"2-digit\",\n    });\n}\n\nfunction showProductModal(product) {\n    document.getElementById(\"modal-title\").textContent = product.title;\n    document.getElementById(\"modal-image\").src = product.images[0];\n    document.getElementById(\"modal-description\").textContent = product.description;\n    document.getElementById(\"modal-price\").textContent = `Precio: ${product.price.amount} ${product.price.currency}`;\n    document.getElementById(\"modal-reserved\").textContent = `Reservado: ${product.reserved ? \"Sí\" : \"No\"}`;\n    document.getElementById(\"modal-link\").href = `https://es.wallapop.com/item/${product.slug}`;\n\n    modal.style.display = \"flex\";\n\n    document.getElementById(\"close-modal\").addEventListener(\"click\", () => {\n        modal.style.display = \"none\";\n    });\n}\n"]}